macro(InstallWxTranslations)
  set(moFiles)
  foreach(dir ${ARGN})
    file(GLOB_RECURSE _tmpFiles ${dir}/*.mo)
    set(moFiles ${moFiles} ${_tmpFiles}) 
  endforeach()

  set(basename wxstd)
  set(moList)
  foreach(_currentMoFile ${moFiles})
    set(_lang)

    if (${_currentMoFile} MATCHES "/locale/([^/\\\\]+)/LC_MESSAGES/${basename}.mo")
      set(_lang ${CMAKE_MATCH_1})
    elseif (${_currentMoFile} MATCHES "/([^/\\\\]+)/${basename}.mo")
      set(_lang ${CMAKE_MATCH_1})
    elseif (${_currentMoFile} MATCHES "/locale/([^./\\\\]+).mo")
      get_filename_component(_tmpPath ${_currentMoFile} PATH)
      if (EXISTS ${_tmpPath}/${basename}.po)
        set(_lang ${CMAKE_MATCH_1})
      endif()
    endif()
    if (_lang)
      if(WIN32)
       set(_moDir ${CMAKE_BINARY_DIR}/bin/${_lang})
      else()
       set(_moDir ${CMAKE_BINARY_DIR}/share/locale/${_lang}/LC_MESSAGES)
      endif()
      SET(_moFile ${_moDir}/${basename}.mo)
      file(MAKE_DIRECTORY ${_moDir})

      ADD_CUSTOM_COMMAND( 
        OUTPUT ${_moFile} 
        COMMAND ${CMAKE_COMMAND} -E copy ${_currentMoFile} ${_moFile} 
        DEPENDS ${_currentMoFile} 
      )
      list(APPEND moList ${_moFile})

      if(WIN32)
       install(FILES ${_moFile} DESTINATION bin/${_lang} RENAME ${basename}.mo)
      else()
       install(FILES ${_moFile} DESTINATION share/locale/${_lang}/LC_MESSAGES RENAME ${basename}.mo)
      endif()
    endif(_lang)
  endforeach()

  add_custom_target(copy_po_dependencies ALL DEPENDS ${moList})

endmacro(InstallWxTranslations)

macro(CopyWxTranslations)
  set(searchdirs)
  if(${wxWidgets_ROOT_DIR})
    get_filename_component(_dir ${wxWidgets_ROOT_DIR} REALPATH)
    if(IS_DIRECTORY ${_dir})
      list(APPEND searchdirs ${_dir})
    endif()
  endif()

  set(_libdirs)
  foreach(_file ${wxWidgets_LIBRARIES})
    string(REGEX REPLACE "^-L(.*)$" "\\1/dummy" _file ${_file})
    get_filename_component(dir ${_file} PATH)
    set(_libdirs ${_libdirs} ${dir})
  endforeach()

  foreach(dir ${wxWidgets_INCLUDE_DIRS} ${wxWidgets_LIBRARY_DIRS} ${_libdirs})
    foreach(postfix locale ../locale ../../locale  share/locale ../share/locale ../../share/locale ../../../share/locale)
      get_filename_component(_dir ${dir}/${postfix} REALPATH)
      if(IS_DIRECTORY ${_dir})
        list(APPEND searchdirs ${_dir})
      endif()
    endforeach()
  endforeach()
  list(REMOVE_DUPLICATES searchdirs)
  message(STATUS "wxTranslation search path: ${searchdirs}")
  InstallWxTranslations(${searchdirs})
endmacro(CopyWxTranslations)

